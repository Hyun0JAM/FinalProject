<?xml version="1.0" encoding="UTF-8"?>

<!-- ===== #28. mapper 기본 설정 ===== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<!-- ===== #29. 루트 엘리먼트 및 네임스페이스 설정하기(이 네임스페이스의 이름은 프로젝트 전체 내에서 반드시 고유해야만 한다.) ===== --> 
<mapper namespace="sw">
	
	<!-- 건물유형(대) -->
	<select id="getBuildList" resultType="String">
		select buildtype
		from buildtype	
	</select>
	
	<!-- 옵션종류 -->
	<select id="getOptionList" resultType="String">
		select optionname, optionicon
		from options
	</select>
	
	<!-- 숙소유형 -->
	<select id="getRoomType" resultType="String">
		select roomtype_name
		from roomtype	
	</select>
	
	<!-- 숙소 이용규칙 -->
	<select id="getRoomRule" resultType="String">
		select rule_name
		from allrule
	</select>
	
	<!-- 건물유형(소)-->
	<select id="getBuildDetailList" parameterType="String" resultType="String">
		select buildtype_detail_name
		from buildtype A JOIN buildtype_detail B
		on A.buildtype_idx = B.fk_buildtype_idx
		where A.buildtype = #{buildName1}
	</select> 
	
	<select id="getRoomList" resultType="com.spring.bnb.model.RoomVO">
		select * from room A join roomType B on A.fk_roomtype_idx = B.roomtype_idx		
	</select>
	
	<resultMap type="HashMap" id="dataResultMap2">
		<result property="OPTIONNAME" column="optionname" javaType="String" />
		<result property="FK_ROOMCODE" column="fk_roomcode" javaType="String" />
	</resultMap>
	
	<select id="getRoomOptionList" parameterType="String" resultMap="dataResultMap2">
		select*from roomoption R join options O on R.fk_option_idx = O.option_idx
		where fk_roomcode = #{roomcode}
	</select>
	
	<resultMap type="HashMap" id="dataResultMap3">
		<result property="RULE_NAME" column="rule_name" javaType="String" />
		<result property="FK_ROOMCODE" column="fk_roomcode" javaType="String" />
	</resultMap>
	
	<select id="getRuleList" parameterType="String" resultMap="dataResultMap3">
		select*from roomrule A join allrule B on A.fk_rule_idx = B.rule_idx
		where fk_roomcode = #{roomcode}
	</select>
	
	<select id="getReservationList" resultType="com.spring.bnb.model.ReservationVO" parameterType="String"> 
		select rsv_name, to_char(rsv_checkindate, 'yyyy-mm-dd') AS rsv_checkindate, to_char(rsv_checkoutdate, 'yyyy-mm-dd') AS rsv_checkoutdate
		     , rsv_phone, guestcount, babycount, rsv_email, fk_userid, totalprice, dcprice, to_char(paydate, 'yyyy-mm-dd') AS paydate, rsv_msg
		from reservation     
		where fk_userid = #{userid}
	</select>	
	 
	<resultMap type="HashMap" id="dataResultMap">
		<result property="ROOMMAINIMG"   column="roommainimg"   javaType="String" />
		<result property="ROOMNAME"      column="roomname"      javaType="String" />
		<result property="ROOMPRICE"     column="roomprice"     javaType="int" />
		<result property="ROOMCODE"      column="roomcode"      javaType="String" />
		<result property="RULENAME"      column="rule_name"     javaType="String" />
		<result property="ROOMTYPE_NAME" column="roomtype_name" javaType="String" />
		<result property="OPTIONNAME"    column="optionname"    javaType="String" />
	</resultMap>
	 
	<select id="getSWOptionList" parameterType="HashMap" resultMap="dataResultMap">
		select roomname, roommainimg, roomprice, roomtel, roomsigungu
			 , basic_person, max_person, person_addpay, viewcount
		     , latitude, longitude, roomcode, optionname, rule_name, roomtype_name
		from room A JOIN roomoption B
		on A.roomcode = B.fk_roomcode
		JOIN options C
		on B.fk_option_idx = c.option_idx
		JOIN roomrule D
		on A.roomcode = D.fk_roomcode
		JOIN allrule E
		on D.fk_rule_idx = E.rule_idx
		where 1 = 1
		<if test="RULENAME != null">		
			<foreach item="rulename" open="('" separator="','" close="')" collection="RULENAME">
				and rule_name in #{rulename}			
			</foreach>
		</if>
		<if test="ROOMTYPE_NAME != null">	
			<foreach item="rtname" open="('" separator="','" close="')" collection="ROOMTYPE_NAME">
				and roomtype_name in #{rtname}			
			</foreach>
		</if>
		<if test="OPTIONNAME != null">	
			<foreach item="opname" open="('" separator="','" close="')" collection="OPTIONNAME">
				and optionname in #{opname}			
			</foreach>
		</if>
	</select>
	
	
 
</mapper>