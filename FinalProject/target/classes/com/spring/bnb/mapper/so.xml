<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="cso">
<resultMap type="HashMap" id="getMyCouponList">
	<!-- <result property="mycp_idx" column="mycp_idx" javaType="String" /> -->
	<result property="cpcode" column="fk_cpcode" javaType="String" />
	<result property="userid" column="fk_userid" javaType="String" />
	<result property="dcmoney" column="dcmoney" javaType="String" />
	<result property="cpexpire" column="cpexpire" javaType="String" />
	<result property="cpname" column="cpname" javaType="String" />
	<result property="usedate" column="usedate" javaType="String" />
</resultMap>

<select id="getMyCoupon" parameterType="String" resultMap="getMyCouponList">
		select mycp_idx,fk_cpcode,cpname,cpexpire,dcmoney,fk_userid,usedate
		from myCoupon A join coupon B
		on A.fk_cpcode = B.cpcode
		where fk_userid=#{loginuser}
		order by mycp_idx
</select>
<select id="getMyInfo" parameterType="String" resultType="com.spring.bnb.model.MemberVO">

	select userid,username,pwd,email,phone,post,addr,detailaddr
        ,gender,to_char(birthday,'yyyy-mm-dd') AS birthday,introduction,memberstatus,profileimg,warncount,regdate
	from member
	where memberstatus =1 and userid = #{loginuser}
</select>

<resultMap type="HashMap" id="resList">
	<result column="username" property="username" javaType="String"/>
	<result column="email" property="email" javaType="String"/>
	<result column="phone" property="phone" javaType="String"/>
	<result column="rsvcode" property="rsvcode" javaType="String"/>
	<result column="roomcode" property="roomcode" javaType="String"/>
	<result column="guestcount" property="guestcount" javaType="String"/>
	<result column="rsv_checkindate" property="rsv_checkindate" javaType="String"/>
	<result column="rsv_checkoutdate" property="rsv_checkoutdate" javaType="String"/>
	<result column="rsv_name" property="rsv_name" javaType="String"/>
	<result column="paydate" property="paydate" javaType="String"/>
	<result column="totalprice" property="totalprice" javaType="String"/>
	<result column="dcprice" property="dcprice" javaType="String"/>
	<result column="rsv_cancledate" property="rsv_cancledate" javaType="String"/>
	<result column="fk_roomtype_idx" property="fk_roomtype_idx" javaType="String"/>
	<result column="roomname" property="roomname" javaType="String"/>
	<result column="roommainimg" property="roommainimg" javaType="String"/>
	<result column="roompost" property="roompost" javaType="String"/>
	<result column="roomsigungu" property="roomsigungu" javaType="String"/>
	<result column="roomsido" property="roomsido" javaType="String"/>
	<result column="roombname" property="roombname" javaType="String"/>
	<result column="latitude" property="latitude" javaType="String"/>
	<result column="longitude" property="longitude" javaType="String"/>
	<result column="roominfo" property="roominfo" javaType="String"/>
	<result column="roomdetailaddr" property="roomdetailaddr" javaType="String"/>
	<result column="checkInDD" property="checkInDD" javaType="String"/>
	<result column="checkInYY" property="checkInYY" javaType="String"/>
	<result column="checkInMM" property="checkInMM" javaType="String"/>
	<result column="checkInDay" property="checkInDay" javaType="String"/>
	<result column="checkOutDD" property="checkOutDD" javaType="String"/>
	<result column="checkOutMM" property="checkOutMM" javaType="String"/>
	<result column="checkOutYY" property="checkOutYY" javaType="String"/>
	<result column="checiOutDay" property="checiOutDay" javaType="String"/>
	<result column="roominfo" property="roominfo" javaType="String"/>
	<result column="roomdetailaddr" property="roomdetailaddr" javaType="String"/>
	<result column="roomtype_name" property="roomtype_name" javaType="String"/>
</resultMap>
<select id="getMemberReservationList" parameterType="String" resultMap="resList">


select A.userid AS userid ,username,email,phone,B.rsvcode AS rsvcode,C.roomcode AS roomcode,guestcount
		   ,babycount,rsv_name,rsv_phone,rsv_name,rsv_email,		   
           to_char(rsv_checkindate,'yyyy-mm-dd') as rsv_checkindate,
           substr(rsv_checkindate,7,2) AS checkInDD,
           substr(rsv_checkoutdate,0,2) AS checkInYY,
           substr(rsv_checkoutdate,4,2) AS checkInMM,
           decode(to_char(rsv_checkindate,'d'),'1','일'
            ,'2','월'
            ,'3','화'
            ,'4','수'
            ,'5','목'
            ,'6','금'
            ,'7','토'
            ) AS checkInDay,
	       to_char(rsv_checkoutdate,'yyyy-mm-dd') as rsv_checkoutdate,
           substr(rsv_checkoutdate,7,2) AS checkOutDD,
           substr(rsv_checkoutdate,0,2) AS checkOutYY,
           substr(rsv_checkoutdate,4,2) AS checkOutMM,
           decode(to_char(rsv_checkoutdate,'d'),'1','일'
            ,'2','월'
            ,'3','화'
            ,'4','수'
            ,'5','목'
            ,'6','금'
            ,'7','토'
            ) AS checiOutDay,
	       to_char(paydate,'yyyy-mm-dd') as paydate,totalprice,dcprice,rsv_cancledate,fk_roomtype_idx,roomname
	       ,roommainimg,roomtel,roompost,roomsigungu,roomsido,roombname,cleanpay,basic_person,
	       rsv_msg,roomcount,bathcount,latitude,longitude,fk_buildtype_detail_idx,roomdetailaddr
           ,roomtype_name
	from member A join reservation B
	      on A.userid = B.fk_userid
	      join room C
          on B.fk_roomcode = C.roomcode
          join roomtype D
          on C.fk_roomtype_idx = D.roomtype_idx
    where A.userid = #{loginuser}

</select> 


<resultMap type="HashMap" id="resDetail">
	<result column="username" property="username" javaType="String"/>
	<result column="email" property="email" javaType="String"/>
	<result column="phone" property="phone" javaType="String"/>
	<result column="rsvcode" property="rsvcode" javaType="String"/>
	<result column="roomcode" property="roomcode" javaType="String"/>
	<result column="guestcount" property="guestcount" javaType="String"/>
	<result column="rsv_checkindate" property="rsv_checkindate" javaType="String"/>
	<result column="rsv_checkoutdate" property="rsv_checkoutdate" javaType="String"/>
	<result column="rsv_name" property="rsv_name" javaType="String"/>
	<result column="paydate" property="paydate" javaType="String"/>
	<result column="totalprice" property="totalprice" javaType="String"/>
	<result column="dcprice" property="dcprice" javaType="String"/>
	<result column="rsv_cancledate" property="rsv_cancledate" javaType="String"/>
	<result column="fk_roomtype_idx" property="fk_roomtype_idx" javaType="String"/>
	<result column="roomname" property="roomname" javaType="String"/>
	<result column="roommainimg" property="roommainimg" javaType="String"/>
	<result column="roompost" property="roompost" javaType="String"/>
	<result column="roomsigungu" property="roomsigungu" javaType="String"/>
	<result column="roomsido" property="roomsido" javaType="String"/>
	<result column="roombname" property="roombname" javaType="String"/>
	<result column="roomcount" property="roomcount" javaType="String"/>
	<result column="latitude" property="latitude" javaType="String"/>
	<result column="longitude" property="longitude" javaType="String"/>
	<result column="roominfo" property="roominfo" javaType="String"/>
	<result column="roomdetailaddr" property="roomdetailaddr" javaType="String"/>
	<result column="checkInDD" property="checkInDD" javaType="String"/>
	<result column="checkInYY" property="checkInYY" javaType="String"/>
	<result column="checkInMM" property="checkInMM" javaType="String"/>
	<result column="checkInDay" property="checkInDay" javaType="String"/>
	<result column="checkOutDD" property="checkOutDD" javaType="String"/>
	<result column="checkOutMM" property="checkOutMM" javaType="String"/>
	<result column="checkOutYY" property="checkOutYY" javaType="String"/>
	<result column="checiOutDay" property="checiOutDay" javaType="String"/>
	<result column="roominfo" property="roominfo" javaType="String"/>
	<result column="roomdetailaddr" property="roomdetailaddr" javaType="String"/>
	<result column="roomtype_name" property="roomtype_name" javaType="String"/>
	<result column="buildtype_detail_idx" property="buildtype_detail_idx" javaType="String"/>
	<result column="buildtype_detail_name" property="buildtype_detail_name" javaType="String"/>
	<result column="buildtype_idx" property="buildtype_idx" javaType="String"/>
	<result column="buildtype" property="buildtype" javaType="String"/>
	<result column="bedtype" property="bedtype" javaType="String"/>
	<result column="bedcount" property="bedcount" javaType="String"/>
	<result column="cleanpay" property="cleanpay" javaType="String"/>
</resultMap>

<select id="getMemberReservationDetail" parameterType="String" resultMap="resDetail">

select A.userid AS userid ,username,email,phone,B.rsvcode AS rsvcode,C.roomcode AS roomcode,guestcount
		   ,babycount,rsv_name,rsv_phone,rsv_name,rsv_email,		   
           to_char(rsv_checkindate,'yyyy-mm-dd') as rsv_checkindate,
           substr(rsv_checkindate,7,2) AS checkInDD,
           substr(rsv_checkoutdate,0,2) AS checkInYY,
           substr(rsv_checkoutdate,4,2) AS checkInMM,
           decode(to_char(rsv_checkindate,'d'),'1','일'
            ,'2','월'
            ,'3','화'
            ,'4','수'
            ,'5','목'
            ,'6','금'
            ,'7','토'
            ) AS checkInDay,
	       to_char(rsv_checkoutdate,'yyyy-mm-dd') as rsv_checkoutdate,
           substr(rsv_checkoutdate,7,2) AS checkOutDD,
           substr(rsv_checkoutdate,0,2) AS checkOutYY,
           substr(rsv_checkoutdate,4,2) AS checkOutMM,
           decode(to_char(rsv_checkoutdate,'d'),'1','일'
            ,'2','월'
            ,'3','화'
            ,'4','수'
            ,'5','목'
            ,'6','금'
            ,'7','토'
            ) AS checiOutDay,
	       to_char(paydate,'yyyy-mm-dd') as paydate,totalprice,dcprice,rsv_cancledate,fk_roomtype_idx,roomname
	       ,roommainimg,roomtel,roompost,roomsigungu,roomsido,roombname,cleanpay,basic_person,
	       rsv_msg,roomcount,bathcount,latitude,longitude,fk_buildtype_detail_idx,roomdetailaddr
           ,roomtype_name,buildtype_detail_idx,buildtype_detail_name,buildtype_idx,buildtype
           ,bedroom_idx,bed_idx,bedcount,bedtype
	from member A join reservation B
	      on A.userid = B.fk_userid
	      join room C
          on B.fk_roomcode = C.roomcode
          join roomtype D
          on C.fk_roomtype_idx = D.roomtype_idx
          join BUILDTYPE_DETAIL E
          on C.fk_buildType_detail_idx = e.buildtype_detail_idx
          join BUILDTYPE F
          on F.BUILDTYPE_IDX = E.FK_BUILDTYPE_IDX 
          join bedroom G
          on G.fk_roomcode = C.roomcode
          join bed H
          on G.bedroom_idx = H.fk_bedroom_idx
          join BEDOBJ I
          on I.bedobj_idx = H.fk_bedobj_idx
    where A.userid = #{luser} and rsvcode=#{rsvcode}
</select> 
<resultMap type="HashMap" id="getMapHashMap">
<result column="rsvcode" property="rsvcode" javaType="String"/>
<result column="fk_roomcode" property="roomcode" javaType="String"/>
<result column="latitude" property="latitude" javaType="String"/>
<result column="longitude" property="longitude" javaType="String"/>
<result column="roomname" property="roomname" javaType="String"/>
<result column="roomsido" property="roomsido" javaType="String"/>
<result column="roomsigungu" property="roomsigungu" javaType="String"/>
<result column="roombname" property="roombname" javaType="String"/>

</resultMap>
<select id="getMap" parameterType="String" resultMap="getMapHashMap">
	select A.rsvcode,A.fk_roomcode,A.fk_userid,latitude,longitude,roomname,roomsido,roomsigungu,roombname
	from reservation A join room B
	on A.fk_roomcode = B.roomcode
	where A.rsvcode like #{rsvcode} and A.fk_userid like #{userid}
</select>

<resultMap type="HashMap" id="myReviewHashMap">
	<result column="review_idx" property="review_idx" javaType="int"/>
	<result column="roomcode" property="roomcode" javaType="String"/>
	<result column="fk_userid" property="host_userid" javaType="String"/>
	<result column="correct" property="correct" javaType="int"/>
	<result column="communicate" property="communicate" javaType="int"/>
	<result column="clean" property="clean" javaType="int"/>
	<result column="position" property="position" javaType="int"/>
	<result column="checkin" property="checkin" javaType="int"/>
	<result column="value" property="value" javaType="int"/>
	<result column="review_content" property="review_content" javaType="String"/>
	<result column="hostanswer" property="hostAnswer" javaType="String"/>
	<result column="roomname" property="roomname" javaType="String"/>
</resultMap>
<select id="getMyReview" parameterType="String" resultMap="myReviewHashMap">

		select A.review_idx,B.roomname,B.roomcode,B.fk_userid AS host_userid,A.correct,
				A.communicate,A.clean,A.position,A.checkin,A.value
				,A.review_content,A.hostanswer,A.review_writedate
		from review A join room B
		on B.roomcode = A.fk_roomcode
		where A.fk_userid = #{userid}
</select>

</mapper>	